# Parser DAA Telegram Bot

## Описание проекта
Этот проект представляет собой Telegram-бота для мониторинга объявлений на Avito, Drom и Auto.ru. Бот использует Selenium для парсинга новых объявлений и фильтрует их по заданным пользователями параметрам. Новые объявления временно хранятся в Redis, а затем рассылаются пользователям.

## Требования
- Git
- Docker & Docker Compose

## Установка и запуск

### 1. Клонирование репозитория
```sh
git clone <repo_url>
cd parser-daa-tg-bot
```

### 2. Настройка переменных окружения
Создайте файл `.env` и укажите в нем:
```
DEBUG=True
TELEGRAM_BOT_TOKEN=<ваш_токен>
DJANGO_SECRET_KEY=<секретный_ключ>
POSTGRES_DB=testdb
POSTGRES_USER=testuser
POSTGRES_PASSWORD=testpass
POSTGRES_HOST=db
POSTGRES_PORT=5432
REDIS_HOST=redis
REDIS_PORT=6379
WEBSITE_URL=https://your-domain.com
```

### 3. Запуск проекта с Docker
```sh
docker-compose up --build -d
```

### 4. Настройка базы данных и админки
После запуска контейнеров выполните настройку базы данных и Django-админки:
```sh
docker-compose exec web python manage.py migrate
docker-compose exec web python manage.py createsuperuser
```
## Затем зайдите в Django-админку и добавьте в качестве сайтов для парсинга avito, drom и autoru (без их указания парсинг не начнется).

## Функционал бота
- **Команда /start** – регистрация пользователя в системе и вывод информации о боте.
- **Настройка фильтров** – каждый пользователь может задать параметры поиска (цена, марка, пробег, двигатель, коробка передач и другие).
- **Запуск и отключение мониторинга** – возможность включить или отключить получение новых объявлений по заданным фильтрам.
- **Автоматическая отправка уведомлений** – бот отправляет новые объявления, соответствующие фильтрам пользователя.

## Основные модули
- **bot/** – Telegram-бот и логика обработки сообщений
- **parsers/** – парсинг Avito, Drom и Auto.ru с использованием Selenium
- **core/** – основные утилиты и настройки
- **users/** – управление пользователями и их фильтрами
- **editing/** – добавление и редактирование приветственного сообщения

## Лицензия
Проект распространяется под лицензией MIT.

## Веб-интерфейс объявлений

Проект теперь включает веб-интерфейс для просмотра и фильтрации объявлений, собранных с различных площадок (Avito, Drom, Auto.ru).

### Возможности веб-интерфейса:

1. **Просмотр объявлений**: 
   - Все объявления отображаются в виде карточек с основной информацией
   - Подробная страница для каждого объявления
   - Пагинация для удобной навигации

2. **Фильтрация объявлений**:
   - По площадке (Avito, Drom, Auto.ru)
   - По городу
   - По марке автомобиля
   - По диапазону цен
   - По году выпуска
   - По типу кузова, двигателю, пробегу и другим параметрам

### Запуск веб-интерфейса:

#### Локально:
```bash
# Активация виртуального окружения
source .venv/bin/activate  # Linux/Mac
# или
.venv\Scripts\activate     # Windows

# Запуск веб-сервера
python manage.py runserver

# Запуск синхронизации Redis с базой данных
python manage.py run_ads_tasks
```

#### Через Docker:
```bash
docker-compose up -d web ads_sync
```

### Доступ к веб-интерфейсу:

- Веб-интерфейс доступен по адресу: http://localhost:8000
- Админ-панель: http://localhost:8000/admin

### Интеграция с Telegram ботом:

В Telegram боте добавлена команда `/all_ads` и кнопка "Смотреть все объявления", которые перенаправляют пользователя на веб-интерфейс, где можно просмотреть все доступные объявления с удобной фильтрацией.
